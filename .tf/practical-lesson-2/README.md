# Практичне заняття №2

Вітаю на другому занятті! Сподіваюсь, перше вам сподобалось, але сьогодні формат роботи трошки інший: відтепер працює над завданням (розшеривши екран) **студент**, інші (в т.ч. ментор) допомагають.

VPC та EC2-інстанси ми вже створювали на минулому занятті, тому не будемо витрачати на них час, вони вже створені за допомогою terraform.

**Сьогодні розглядаємо**:

- Створення бази даних в приватній мережі (Тема 6. Сховища даних в AWS)
- Створення повноцінного web-застосунку в ECS (Тема 5. Контейнеризація в AWS)
- Доступ до приватної бази даних через так званий bastion-інстанс
- Вступна інформація до ДЗ по темам 8-9

> [!IMPORTANT]
> Всі ключі, паролі, посилання, тощо будуть недійсні вже по закінченню заняття!

## Завдання

1. Створити RDS для проєкту
   - Створити Security group, яка дозволяє доступ до бази даних лише всередині мережі (`100.64.0.0/16` або security group `django-application`)
   - Створити Subnet group в приватній мережі
   - Створити RDS-інстанс db.t3.micro без публічного доступу
   - Дані для підключення пошерити в Slack
2. Підготувати docker-image
   - Зклонувати git-репозиторій з кодом
   - Створити ECR-репозиторій
   - Збілдити docker-image
   - Запушити в ECR (памʼятаємо про `--profile`!)
3. Створити ECS-кластер
   - Створити ECS-кластер
   - Створити визначення завдання (Task definition) з параметрами:
     - [TODO]
4. Налаштувати bastion-інстанс
   - Встановити postgresql для прямого доступу до бази даних
   - Зклонувати репозиторій django_app та створити віртуальне середовище (virtualenv/venv)
   - Налаштувати змінні оточення та створити адміністратора сайту (`python manage.py createsuperuser`)

## Самостійне відтворення чи повторення

### Створення підготовленої інфраструктури

Щоб потренуватися самостійно (чи ще раз) над завданнями, [встановіть terraform](https://developer.hashicorp.com/terraform/install), зклонуйте цей репозиторій і в ньому перейдіть в папку `.tf/practical-lesson-2`, ініціалізуйте terraform та застосуйте:

```bash
cd .tf/practical-lesson-2
terraform init
terraform apply
```

> [!WARNING]
> Без додаткових налаштувань terraform буде використовувати дані з дефолтного профілю!
> ([деталі](https://registry.terraform.io/providers/hashicorp/aws/latest/docs?product_intent=terraform#authentication-and-configuration))

### Видалення підготовленої інфраструктури

**Лише після видалення всього, що створите по завданню**, видаліть створені за допомогою terraform ресурси командою

```bash
terraform destroy
```

> [!IMPORTANT]
> Якщо в VPC на момент виконання команди будуть існувати ресурси, про яких не знає terraform, скоріш за все дестрой зафейлиться
